<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogos de labirinto </title>
</head>
<body>
    <div style="width: 600px;margin: 0 auto;padding-top: 40px;">
        <canvas width="600" height="400" style="border: solid 3px rgb(11, 53, 11);"></canvas>
    </div>
    <script type="text/javascript" src="retangulo.js"></script>
    <script type="text/javascript" src="colissao.js"></script>
    <script>
        const cnv = document.querySelector('canvas');
        const ctx = cnv.getContext('2d');

        const LEFT = 37, UP = 38, RIGHT = 39, DOWN = 40;

        let mvLeft = mvUp = mvRight = mvDown = false;

        let personagens = [];
        let blocos = [];

        let principal = new Retangulo(100,200,50,50,"green");
        principal.velocidade = 3;
        personagens.push(principal);

        let bloco1 = new Retangulo(200,300,100,50,"red");
        personagens.push(bloco1);
        blocos.push(bloco1);

        let bloco2 = new Retangulo(500,100,50,100,"blue");
        personagens.push(bloco2);
        blocos.push(bloco2);

        let bloco3 = new Retangulo(300,50,100,50,"yellow");
        personagens.push(bloco3);
        blocos.push(bloco3);

        window.addEventListener('keydown', function(e){
            let key = e.keyCode;
            switch(key){
                case LEFT: 
                    mvLeft = true;
                    break;
                case UP: 
                    mvUp = true;
                    break;
                case RIGHT: 
                    mvRight = true;
                    break;
                case DOWN: 
                    mvDown = true;
                    break;
            }
        },false);

        window.addEventListener('keyup', function(e){
            let key = e.keyCode;
            switch(key){
                case LEFT: 
                    mvLeft = false;
                    break;
                case UP: 
                    mvUp = false;
                    break;
                case RIGHT: 
                    mvRight = false;
                    break;
                case DOWN: 
                    mvDown = false;
                    break;
            }
        },false);

        function Atualizar(){
            if(mvLeft && !mvRight){
                principal.posX -= principal.velocidade;
            }
            if(mvRight && !mvLeft){
                principal.posX += principal.velocidade;
            }
            if(mvUp && !mvDown){
                principal.posY -= principal.velocidade;
            }
            if(mvDown && !mvUp){
                principal.posY += principal.velocidade;
            }
            principal.posX = Math.max(0, Math.min(cnv.width - principal.width, principal.posX));
            principal.posY = Math.max(0, Math.min(cnv.height - principal.height, principal.posY));

            for(let i = 0; i < blocos.length; i++){
                let blk = blocos[i];
                if(blk.visible){
                    blocoRect(blk,principal);
                }
            }
        }
        function Desenhar(){
            ctx.clearRect(0, 0, cnv.width, cnv.height);
            for(let i = 0; i < personagens.length; i++){
                let desenho = personagens[i];
                if(desenho.visible){
                    ctx.fillStyle = desenho.color;
                    ctx.fillRect(desenho.posX, desenho.posY, desenho.width, desenho.height);
                }
            }
        }
        function Repetir(){
            Atualizar();
            Desenhar();
            window.requestAnimationFrame(Repetir, cnv);
        }
        Repetir();
    </script>
</body>
</html>